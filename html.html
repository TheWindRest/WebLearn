<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>测试</title>
    <style>
        .my-bottom {
            position: fixed;
            bottom: 0px;
            width: 100%;
            text-align: center;
            background-color: rosybrown;
        }
    </style>
</head>
<body>
    <header class="my-head">头部</header>
    <section>内容</section>
    <footer class="my-bottom">底部</footer>
    <script>
        // Init SpeechSynth API
        const synth = window.speechSynthesis

        // 获取元素
        const textForm = document.querySelector('form')
        const textInput = document.querySelector('#text-input')
        const voiceSelect = document.querySelector('#voice-select')
        const rate = document.querySelector('#rate')
        const rateValue = document.querySelector('#rate-value')
        const pitch = document.querySelector('#pitch')
        const pitchValue = document.querySelector('#pitch-value')
        const body = document.querySelector('body')

        // Init Voice Array
        let voices = []

        // 异步获取声音文件
        const getVoices = () => {
        voices = synth.getVoices()

        // 初始化声音文件选择器
        voices.forEach(voice => {
            const option = document.createElement('option')
            // option label
            option.textContent = voice.name + '(' + voice.lang + ')'
            // option attr
            option.setAttribute('data-lang', voice.lang)
            option.setAttribute('data-name', voice.name)
            voiceSelect.appendChild(option)
        })
        }

        getVoices()
        if (synth.onvoiceschanged !== undefined) {
        synth.onvoiceschanged = getVoices // 异步获取
        }

        // Speak
        const speak = () => {
        // 是否正在speak
        if (synth.speaking) {
            console.error('慢点~说着呢...')
            alert('别按太快！！')
            return
        }
        // 可以speak
        if (textInput.value.trim() !== '') {
            // Add background animation
            body.style.background = '#141414 url(img/wave.gif)'
            body.style.backgroundSize = '100% 100%'
            // Speech对象初始化
            const speakText = new SpeechSynthesisUtterance(textInput.value)

            // 相关回调
            speakText.onerror = e => {
            console.error('出错了..')
            }
            speakText.onend = e => {
            console.log('这段说完了..')
            body.style.background = '#141414'
            }

            // 声音配置初始化
            // current selected name
            const selectedVoice = voiceSelect.selectedOptions[0].getAttribute(
            'data-name'
            )
            // get voice file
            voices.forEach(voice => {
            if (voice.name === selectedVoice) {
                speakText.voice = voice
            }
            })
            // rate
            speakText.rate = rate.value
            speakText.pitch = pitch.value

            // Speak
            synth.speak(speakText)
        } else {
            console.error('输入点什么呗！')
        }
        }

        // 绑定事件
        // Submit
        textForm.addEventListener('submit', e => {
        e.preventDefault()
        speak()
        textInput.blur()
        })

        // Rate value change
        // Rate value change
        rate.addEventListener('change', e => (rateValue.textContent = rate.value))

        // Pitch value change
        pitch.addEventListener('change', e => (pitchValue.textContent = pitch.value))

        // Voice select change
        voiceSelect.addEventListener('change', e => speak())

    </script>
</body>